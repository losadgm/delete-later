ifndef::imagesdir[:imagesdir: ../images]

[[section-building-block-view]]


== Building Block View


ifdef::arc42help[]
[role="arc42help"]
****
.Content
The building block view shows the static decomposition of the system into building blocks (modules, components, subsystems, classes, interfaces, packages, libraries, frameworks, layers, partitions, tiers, functions, macros, operations, data structures, ...) as well as their dependencies (relationships, associations, ...)

This view is mandatory for every architecture documentation.
In analogy to a house this is the _floor plan_.

.Motivation
Maintain an overview of your source code by making its structure understandable through
abstraction.

This allows you to communicate with your stakeholder on an abstract level without disclosing implementation details.

.Form
The building block view is a hierarchical collection of black boxes and white boxes
(see figure below) and their descriptions.

image::05_building_blocks-EN.png["Hierarchy of building blocks"]

*Level 1* is the white box description of the overall system together with black
box descriptions of all contained building blocks.

*Level 2* zooms into some building blocks of level 1.
Thus it contains the white box description of selected building blocks of level 1, together with black box descriptions of their internal building blocks.

*Level 3* zooms into selected building blocks of level 2, and so on.

.Further Information
See https://docs.arc42.org/section-5/[Building Block View] in the arc42 documentation.
****
endif::arc42help[]


=== Whitebox Overall System

[plantuml, overview-diagram, svg]
....
@startuml
left to right direction
skinparam componentStyle rectangle

actor "Player" as player
actor "External client\n(Public API consumer)" as ext

rectangle "Web Frontend\n(TypeScript SPA)" as fe
rectangle "webapp-backend\n(Game API / BFF)" as webapp
rectangle "users service\n(User API / Auth)" as users
rectangle "gamey\n(Rust engine)" as gamey
database "MariaDB" as db

player --> fe : UI

fe --> users : REST (login/profile)
fe --> webapp : REST/WebSocket (game)

ext --> users : REST (User API)
ext --> webapp : REST (Game API)

webapp --> users : REST (auth + profile)
webapp --> gamey : HTTP (JSON/YEN)

users --> db : read/write
@enduml
....

ifdef::arc42help[]
[role="arc42help"]
****
Here you describe the decomposition of the overall system using the following white box template. It contains

 * an overview diagram
 * a motivation for the decomposition
 * black box descriptions of the contained building blocks. For these we offer you alternatives:

   ** use _one_ table for a short and pragmatic overview of all contained building blocks and their interfaces
   ** use a list of black box descriptions of the building blocks according to the black box template (see below).
   Depending on your choice of tool this list could be sub-chapters (in text files), sub-pages (in a Wiki) or nested elements (in a modeling tool).

 * (optional:) important interfaces, that are not explained in the black box templates of a building block, but are very important for understanding the white box.
Since there are so many ways to specify interfaces why do not provide a specific template for them.
 In the worst case you have to specify and describe syntax, semantics, protocols, error handling,
 restrictions, versions, qualities, necessary compatibilities and many things more.
In the best case you will get away with examples or simple signatures.
****
endif::arc42help[]


Rationale::
We applied *functional decomposition* to separate responsibilities within the YOVI system and keep clear client/server boundaries.

Contained Blackboxes::

[cols="1,3", options="header"]
|===
| Building Block | Description

| Web Frontend
| Browser-based TypeScript application. Renders the Y game board, handles user interaction, and communicates with the public APIs via REST (and WebSockets when realtime gameplay is enabled).

| webapp-backend (Game API / BFF)
| Node/TypeScript service exposing the public Game API (match flow, play actions, game-related statistics). Orchestrates calls to `gamey` using JSON/YEN and calls `users` when authentication/profile data is required.

| users service (User API / Auth)
| Service exposing the public User API (register/login/profile). Issues and verifies JWTs, applies basic authorization (roles), and is the only component that accesses MariaDB.

| gamey (Rust engine)
| Rust service responsible for validating game states and computing the next move. Uses YEN notation for board representation and exposes a minimal JSON-based web service interface to `webapp-backend`.

| Database (MariaDB)
| Persistent storage for user accounts and credentials/roles. Accessed exclusively by the `users` service.

| Player (external)
| Human user interacting through the Web Frontend to play matches and manage their account.

| External client (external)
| Any third-party client consuming the public APIs (User API and/or Game API) over HTTP, e.g., automated gameplay clients.
|===



=== Level 2

[plantuml, level2-diagram, svg]
....
@startuml
left to right direction
skinparam componentStyle rectangle

package "webapp-backend (Game API / BFF)" as PWebapp {
  [Routes] as WebappRoutes
  [MatchService] as MatchService
  [RustClient] as RustClient
}

package "users service (User API / Auth)" as PUsers {
  [Routes] as UsersRoutes
  [UserService] as UserService
  [UserRepository] as UserRepo
}

package "gamey (Rust engine)" as PGamey {
  [Axum API] as GameyApi
  [YENAdapter] as YENAdapter
  [Validator + Bot] as BotCore
}

database "MariaDB" as db

WebappRoutes --> MatchService
MatchService --> RustClient
RustClient --> GameyApi : HTTP (JSON/YEN)

BotCore --> YENAdapter
GameyApi --> BotCore 

WebappRoutes --> UserService : REST (auth + profile)
UsersRoutes --> UserService
UserService --> UserRepo
UserRepo --> db
@enduml
....

ifdef::arc42help[]
[role="arc42help"]
****
Here you can specify the inner structure of (some) building blocks from level 1 as white boxes.

You have to decide which building blocks of your system are important enough to justify such a detailed description.
Please prefer relevance over completeness. Specify important, surprising, risky, complex or volatile building blocks.
Leave out normal, simple, boring or standardized parts of your system
****
endif::arc42help[]


==== Level 2 - webapp-backend (Game API / BFF)

[cols="1,3", options="header"]
|===
| Building Block | Description

| Routes
| Single entry point for the public APIs exposed by `webapp-backend`. Delegates game requests to *MatchService* and forwards authentication/profile operations to the `users` service.

| MatchService
| Encapsulates game workflow logic: creating matches/rooms, updating board states, and coordinating validation and next-move computations. Calls `users` only for authentication/profile data when required.

| RustClient
| HTTP client responsible for invoking the `gamey` service. Sends board state in JSON/YEN format to request validation or next-move suggestions.
|===


==== Level 2 - users service (User API / Auth)

[cols="1,3", options="header"]
|===
| Building Block | Description

| Routes
| Handles HTTP requests entering the User API. Delegates to *UserService*.

| UserService
| Business logic for authentication and user operations (issue/verify JWTs, profile management, role checks). Coordinates persistence via *UserRepository*.

| UserRepository
| Persistence component managing user accounts and credentials/roles (create, read, update, delete). Accessed exclusively via *UserService*.
|===


==== Level 2 - gamey (Rust engine)

[cols="1,3", options="header"]
|===
| Building Block | Description

| Axum API
| Minimal internal HTTP interface invoked by `webapp-backend` for validation and choose-move requests.

| YENAdapter
| Parses and serializes YEN/JSON game states and converts them to/from internal board representation.

| Validator + Bot
| Enforces game rules and computes next moves.
|===
