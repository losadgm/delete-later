ifndef::imagesdir[:imagesdir: ../images]

[[section-concepts]]
== Cross-cutting Concepts


ifdef::arc42help[]
[role="arc42help"]
****
.Content
This section describes overall, principal regulations and solution ideas that are relevant in multiple parts (= cross-cutting) of your system.
Such concepts are often related to multiple building blocks.
They can include many different topics, such as

* models, especially domain models
* architecture or design patterns
* rules for using specific technology
* principal, often technical decisions of an overarching (= cross-cutting) nature
* implementation rules


.Motivation
Concepts form the basis for _conceptual integrity_ (consistency, homogeneity) of the architecture. 
Thus, they are an important contribution to achieve inner qualities of your system.

Some of these concepts cannot be assigned to individual building blocks, e.g. security or safety. 


.Form
The form can be varied:

* concept papers with any kind of structure
* cross-cutting model excerpts or scenarios using notations of the architecture views
* sample implementations, especially for technical concepts
* reference to typical usage of standard frameworks (e.g. using Hibernate for object/relational mapping)

.Structure
A potential (but not mandatory) structure for this section could be:

* Domain concepts
* User Experience concepts (UX)
* Safety and security concepts
* Architecture and design patterns
* "Under-the-hood"
* development concepts
* operational concepts

Note: it might be difficult to assign individual concepts to one specific topic
on this list.

image::08-concepts-EN.drawio.png["Possible topics for crosscutting concepts"]


.Further Information

See https://docs.arc42.org/section-8/[Concepts] in the arc42 documentation.
****
endif::arc42help[]

=== YEN - JSON Game State (domain contract)

Purpose::
Represent the state of a Game Y match at a particular point of time. Domain contract between +
`webapp-backend` <--> `gamey`.

Format::
The game state is serialized as JSON using YEN notation.

.Example:
[source,json]
----
{
  "size": 4,
  "turn": "R",
  "players": [ "B", "R" ],
  "layout": "B/.B/RB./B..R"
}
----

Minimal invariants::
* _size_: integer > 0.
* _turn_: must be a player ID from the players list.
* _players_: an array holding player IDs, currently "B" and "R".
* _layout_: string representation of the board, '/' is the separator and '.' represents an empty cell.
* The system  responds with a 4xx error for invalid states (see 8.2 / 8.2.1).

Compatibility::
* We only publish one version of the API as part of M1, and we're not too concerned about backward compatibility.
* Any breaking change must be reflected in the documentation and contract tests.

=== REST conventions

Scope::
- Applies to:
  * `webapp-backend` -> `frontend`
  * `webapp-backend` -> `users`
  * `webapp-backend` -> `gamey`

Conventions::
- JSON as the default payload format.
- HTTP status codes:
  * 2xx success, 4xx client/request/validation/auth error, 5xx internal/server error.
- Timeouts and retries:
  * Calls to `gamey`/`users` must use finite timeouts.
  * Do not automatically retry non-idempotent operations (if any exist).
- Recommended headers
  * Content-Type: application/json
  * Accept: application/json

=== Authentication and authorization

Scope::
- Applies to public endpoints exposed by `users` (authentication/user management) and to protected endpoints in `webapp-backend` (game interaction).

Authentication::
- `users` acts as the auth server: it issues JWTs and verifies them (HS256).
- Clients send JWTs in `Authorization: Bearer <token>`; `webapp-backend` may also verify them when protecting endpoints.

Authorization::
- Role-based access control with roles: `player` and `admin`.
- Default rule: a user can only access/modify their own data; admin-only operations (if any) require `admin`.

=== Backend for Frontend (BFF)

Principles::
- The frontend only consumes `webapp-backend`.
- `users` and `gamey` are not accessible from the browser (no direct routing and no CORS exposure).

Motivation::
- Simplifies the frontend and centralizes auth and service composition in one place.

=== Development concepts

Rules::
- Trunk-based development with short-lived branches.
- Changes reach trunk (master) only via Pull Request.
- Mandatory checks before merge: at least 1 human approval + green CI.
- Pull Requests are merged using squash merge to keep a linear history.
- Merge without feature flags to prioritize simplicity.

=== User Experience (UX)
TBD

...

=== Configuration and secrets

Rules::
- Environment-specific configuration is injected from the outside (e.g., environment variables in compose/CI).
- Secrets (keys, tokens, passwords) are never committed to the repo and never baked into images; local dev uses a non-committed `.env`.
- Do not log secret, mask if needed.